{% extends 'base.html' %}
{% block content %}
<div class="container-fluid p-4 p-md-5">
  <h2 class="fw-bold mb-4 heading-accent">
    <i class="bi bi-lightning-fill me-2"></i>Today's Deals
  </h2>

  {% if deals %}
  <div class="row g-4">
    {% for p in deals %}
    <div class="col-6 col-md-3 mb-2">
      <div class="card h-100 product-card position-relative shadow-sm hover-lift">
        <div class="product-badges"><span class="badge-deal animate-pulse"><i class="bi bi-lightning-fill me-1"></i>Deal</span></div>
        <div class="ratio ratio-4x3 overflow-hidden bg-light">
          <img loading="lazy" class="card-img-top object-fit-cover" src="{{ cl_transform(p.image_url, 600, 450) or 'https://placehold.co/600x400' }}" alt="{{p.name}}">
        </div>
        <div class="card-body d-flex flex-column">
          <h6 class="card-title mb-2 text-truncate fw-600" title="{{p.name}}">{{p.name}}</h6>
          <div class="mb-3">
            <span class="text-success fw-bold fs-5">Ksh {{p.price}}</span>
            {% if p.old_price %}<small class="text-muted text-decoration-line-through ms-2">{{p.old_price}}</small>{% endif %}
            {% if sale_ends and sale_ends.get(p.id) %}
              <div class="small text-muted mt-1">Ends in: <span data-sale-ends="{{ sale_ends.get(p.id) }}"></span></div>
            {% endif %}
          </div>
          <div class="mt-auto d-flex gap-2 flex-wrap">
            <a class="btn btn-sm btn-outline-success fw-600" href="/product/{{p.slug}}"><i class="bi bi-eye"></i> <span class="d-none d-lg-inline">View</span></a>
            {% if current_user.is_authenticated %}
              <button class="btn btn-sm btn-success btn-add-to-cart btn-async fw-600" data-product-id="{{p.id}}"><i class="bi bi-bag-plus"></i> <span class="d-none d-lg-inline">Add</span></button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center text-muted py-5">
    No deals available today. Check back later.
  </div>
  {% endif %}
</div>
{% endblock %}
