<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{{ site_name }}{% endblock %}</title>
    {% block meta %}
    <meta name="description" content="Fresh groceries delivered fast across Nairobi & surrounding areas.">
    <meta property="og:title" content="{{ site_name }}">
    <meta property="og:description" content="Shop fruits, vegetables, cereals, and household essentials.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/">
    {% endblock %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <!-- Top banner with rotating messages (Green Basket inspired) -->
    <style>
      .top-banner { background: linear-gradient(90deg,#ef4444,#f59e0b); color: white; }
      .top-banner .rotator { font-weight:700; letter-spacing:0.6px; }
      .rotator.fade { opacity: 0; transition: opacity .35s ease-in-out; }
      .rotator.show { opacity: 1; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/theme.css') }}?v={{ datetime.utcnow().timestamp()|int }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}?v={{ datetime.utcnow().timestamp()|int }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/animations.css') }}?v={{ datetime.utcnow().timestamp()|int }}" rel="stylesheet">
    <style>
      body { background-color: #ffffff; color: #0f172a; }
      .container { max-width: 1200px; margin: 0 auto; }
    </style>
    {% block head %}{% endblock %}
  </head>
  <body class="page-fade" style="background: white; color: #000;">
    <div class="top-banner py-2 d-none d-md-block">
      <div class="container d-flex align-items-center justify-content-between">
        <div class="marquee-viewport">
          <div id="promo-marquee" class="marquee-track" role="status" aria-live="polite"></div>
        </div>
      </div>
    </div>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top" id="mainNavbar">
      <div class="container py-2">
        <a class="navbar-brand fw-bold brand" href="/">
          <i class="bi bi-leaf-fill me-2"></i>ScholaGro
        </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div id="nav" class="collapse navbar-collapse">
          <ul class="navbar-nav me-auto align-items-lg-center">
            <li class="nav-item">
              <a class="nav-link" href="/shop">
                <i class="bi bi-shop me-1"></i>Shop
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/why-us">
                <i class="bi bi-info-circle me-1"></i>Why Us
              </a>
            </li>
          </ul>
            <form class="d-flex me-3 nav-search" action="/search" method="get">
            <div class="input-group">
              <input class="form-control" type="search" placeholder="Search fresh groceries..." name="q" aria-label="Search products">
              <button class="btn btn-outline-success" type="submit" aria-label="Search">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </form>
          <ul class="navbar-nav ms-3">
            <li class="nav-item d-none d-lg-flex align-items-center me-2">
              <button id="themeToggle" class="btn btn-outline-secondary btn-sm" aria-label="Toggle dark mode" data-bs-toggle="tooltip" title="Toggle dark mode">
                <i class="bi bi-moon-stars" id="themeIcon"></i>
              </button>
            </li>
            <li class="nav-item">
              <a class="nav-link position-relative" href="/cart/" aria-label="Shopping cart">
                <i class="bi bi-bag-fill"></i>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success" id="cart-count-badge">{{ cart_count }}</span>
              </a>
            </li>
            {% if current_user.is_authenticated %}
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="userMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-person-circle me-1"></i>Account
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                <li><a class="dropdown-item" href="/account/profile"><i class="bi bi-person me-2"></i>Profile</a></li>
                <li><a class="dropdown-item" href="/orders"><i class="bi bi-clipboard-check me-2"></i>My Orders</a></li>
                <li><a class="dropdown-item" href="/wishlist/"><i class="bi bi-heart me-2"></i>Wishlist</a></li>
                <li><a class="dropdown-item" href="/account/saved"><i class="bi bi-bookmark me-2"></i>Saved for later</a></li>
                <li><a class="dropdown-item" href="/account/addresses"><i class="bi bi-geo-alt me-2"></i>Addresses</a></li>
                {% if current_user.is_admin %}
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/admin/"><i class="bi bi-speedometer2 me-2"></i>Admin Dashboard</a></li>
                <li><a class="dropdown-item" href="/admin/payments"><i class="bi bi-credit-card me-2"></i>Payments</a></li>
                {% endif %}
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/auth/logout"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
              </ul>
            </li>
            {% else %}
            <div class="d-flex align-items-center">
                <a href="/auth/login" class="btn btn-success me-2"><i class="bi bi-box-arrow-in-right"></i> Login</a>
            </div>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <div class="container py-4">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="my-2" id="flash-container">
            {% for category, message in messages %}
              <div class="alert alert-{{category}}">{{message}}</div>
            {% endfor %}
          </div>
          <script type="application/json" id="flashes-data">{{ messages|tojson }}</script>
        {% endif %}
      {% endwith %}
      {% block content %}{% endblock %}
    </div>
    <footer class="border-top py-5 bg-white">
      <div class="container">
        <div class="row g-4 align-items-start">
          <div class="col-12 col-md-4">
            <a href="/" class="navbar-brand fw-bold brand d-inline-flex align-items-center mb-2">
              <i class="bi bi-leaf-fill me-2"></i>{{ site_name or 'ScholaGro' }}
            </a>
            <p class="text-muted mb-2">Fresh groceries delivered fast across Nairobi & nearby areas.</p>
            <div class="d-flex gap-2">
              <a class="btn btn-sm btn-outline-secondary" href="https://facebook.com" target="_blank" rel="noopener" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
              <a class="btn btn-sm btn-outline-secondary" href="https://instagram.com" target="_blank" rel="noopener" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
              <a class="btn btn-sm btn-outline-secondary" href="https://twitter.com" target="_blank" rel="noopener" aria-label="Twitter"><i class="bi bi-twitter-x"></i></a>
              <a class="btn btn-sm btn-outline-secondary" href="https://wa.me/254757391071" target="_blank" rel="noopener" aria-label="WhatsApp"><i class="bi bi-whatsapp"></i></a>
            </div>
          </div>
          <div class="col-6 col-md-2">
            <h6 class="fw-bold mb-2">Pages</h6>
            <ul class="list-unstyled small">
              <li><a class="text-decoration-none text-muted" href="/shop">Shop</a></li>
              <li><a class="text-decoration-none text-muted" href="/pages/delivery">Delivery</a></li>
              <li><a class="text-decoration-none text-muted" href="/pages/faqs">FAQs</a></li>
              <li><a class="text-decoration-none text-muted" href="/pages/contact">Contact</a></li>
            </ul>
          </div>
          <div class="col-6 col-md-2">
            <h6 class="fw-bold mb-2">Legal</h6>
            <ul class="list-unstyled small">
              <li><a class="text-decoration-none text-muted" href="/pages/privacy">Privacy Policy</a></li>
              <li><a class="text-decoration-none text-muted" href="/pages/terms">Terms & Conditions</a></li>
            </ul>
          </div>
          <div class="col-12 col-md-4">
            <h6 class="fw-bold mb-2">Contact</h6>
            <ul class="list-unstyled small text-muted mb-3">
              <li><i class="bi bi-envelope me-2"></i>support@scholagro.com</li>
              <li><i class="bi bi-telephone me-2"></i>0757391071</li>
              <li><i class="bi bi-geo-alt me-2"></i>Nairobi, Kenya</li>
            </ul>
            {% include 'partials/hours_map_compact.html' %}
          </div>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
          <small class="text-muted">Â© {{ site_name }} {{ 2025 }}</small>
          <small class="text-muted">Powered by {{ site_name }}</small>
        </div>
      </div>
    </footer>

    <div class="position-fixed top-0 end-0 p-3 toast-container" role="region" aria-live="polite" aria-atomic="true">
      <div id="toast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body" id="toast-body"></div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Please Confirm</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="confirmModalBody">Are you sure?</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirmModalYes">Yes</button>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}?v={{ datetime.utcnow().timestamp()|int }}"></script>
  </body>
</html>
