{% extends 'admin/base.html' %}
{% block breadcrumbs %}
  <nav class="px-4 pb-3 text-sm text-slate-500 dark:text-slate-400" aria-label="breadcrumb">
    <ol class="breadcrumb m-0">
      <li class="breadcrumb-item"><a href="/admin">Admin</a></li>
      <li class="breadcrumb-item active" aria-current="page">Analytics</li>
    </ol>
  </nav>
{% endblock %}
{% block content %}
<div class="container-fluid">
  <div class="d-flex align-items-center mb-3">
    <h3 class="mb-0 fw-bold">Analytics</h3>
  </div>

  <div class="row g-3">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between">
            <h5 class="card-title mb-0">Sales by Day</h5>
          </div>
          <canvas id="salesByDay" height="260" class="mt-3"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title mb-0">User Signups</h5>
          <canvas id="userGrowth" height="260" class="mt-3"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  (function(){
    try {
      // Sales by day
      const sbd = document.getElementById('salesByDay');
      if (sbd){
        const labels = [{% for day, total in sales_by_day %}{{ (day|string)|tojson }},{% endfor %}];
        const data = [{% for day, total in sales_by_day %}{{ (total or 0)|float }},{% endfor %}];
        new Chart(sbd, { type:'line', data:{ labels, datasets:[{ label:'KES', data, borderColor:'#16a34a', backgroundColor:'rgba(22,163,74,.15)', fill:true, tension:.35 }] }, options:{ plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } } });
      }
      // User growth
      const ug = document.getElementById('userGrowth');
      if (ug){
        const labels = [{% for day, count in user_growth %}{{ (day|string)|tojson }},{% endfor %}];
        const data = [{% for day, count in user_growth %}{{ count }},{% endfor %}];
        new Chart(ug, { type:'bar', data:{ labels, datasets:[{ label:'New Users', data, backgroundColor:'#0ea5e9' }] }, options:{ plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } } });
      }
    } catch(e){}
  })();
</script>
{% endblock %}
